%% Wastewater data analysis
% Daniele Proverbio - LCSB Lux
% 24/03/2021
% Also refer to .ipynb notebook

clc
clear all
close all


%% Changepoint detection

data= [18700000000.0000,19900000000.0000,27100000000.0000,69700000000.0000,476000000000.000,299000000000.000,98200000000.0000,89600000000.0000,58300000000.0000,84200000000.0000,71700000000.0000,43700000000.0000,20800000000.0000,33400000000.0000,15800000000.0000,29900000000.0000,139000000000.000,93600000000.0000,133000000000.000,205000000000.000,269000000000.000,164000000000.000,214000000000.000,238000000000.000,84500000000.0000,61900000000.0000,83600000000.0000,129000000000.000,126000000000.000,139000000000.000,208000000000.000,209000000000.000,775000000000.000,2100000000000.00,4450000000000.00,2350000000000.00,3330000000000.00,2620000000000.00,2380000000000.00,2740000000000.00,3030000000000.00,3300000000000.00,2650000000000.00,2070000000000.00,2230000000000.00,1640000000000.00,1350000000000.00,2270000000000.00,691000000000.000,978000000000.000,578000000000.000,1070000000000.00,1030000000000.00,1110000000000.00,401000000000.000,291000000000.000,418000000000.000,336000000000.000,566000000000.000,386000000000.000,183000000000.000,315000000000.000,255000000000.000,224000000000.000,225000000000.000,336000000000.000,329000000000.000,530000000000.000,456000000000.000,739000000000.000,853000000000.000,616000000000.000,440000000000.000,342000000000.000,412000000000.000,474000000000.000,365000000000.000,599000000000.000,289000000000.000,467000000000.000,846000000000.000,262000000000.000,267000000000.000,187000000000.000];
dataLog = log(data);

[TF,S1,S2] = ischange(dataLog,'linear');%,'Threshold',200);
segline = S1.*(1:length(data)) + S2;
figure
hold on
plot(1:length(data),dataLog,'o',linewidth=1)
plot(1:length(data),segline,linewidth=1)              
legend('Data','Linear Regime',fontsize=14)
xlabel("Point nr.",fontsize=16)
ylabel("SARS-CoV-2 RNA abundance in wastewater",fontsize=16)

